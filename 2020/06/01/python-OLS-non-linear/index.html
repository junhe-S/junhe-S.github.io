<!DOCTYPE html>
<html lang="en">
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="John Ho">


    <meta name="subtitle" content="One who loves the world">


    <meta name="description" content="Generate electricity from love.">


    <meta name="keywords" content="python">


<title>python_OLS_non_linear | John Ho&#39;s Blog</title>



    <link rel="icon" href="/img/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
            <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


        
    


<link rel="stylesheet" href="/styles/vs2015.css">

<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>
<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">John Ho&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories/%E5%AD%A6%E4%B9%A0">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">John Ho&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories/%E5%AD%A6%E4%B9%A0">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">python_OLS_non_linear</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">John Ho</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">June 1, 2020&nbsp;&nbsp;15:20:54</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <p>
    statsmodels.api.OLS (endog, exog, missing, hasconst)
    $$Y = \beta_0 X_0 + \beta_1 X_1 + \dots +\beta_n X_n $$ 
    <li>endog (endogenous variable)，是上面模型中的 $Y(t)$, 输入是一个长度为 k 的 array。</li>
    <li>exog (exogenous variable), 即模型中的$\beta_0 X_0 + \beta_1 X_1 + \dots +\beta_n X_n $。</li>
    假设回归公式是:
    $$Y = 5 + 0.5X_1 + 0.5sin(X_1) + (X_1 - 5)^2$$
    设定数据量，也就是上面的 k 值。
    <pre style="background-color: #f5f5f5">nsample = 100</pre>
    然后创建一个 array，是上面的 $x_1$ 的数据。这里，我们想要 $x_1$ 的值从 0 到 20 等差排列。
    <pre style="background-color: #f5f5f5">x = np.linspace(0, 20, nsample)</pre>
    转化数组为矩阵, 目标自变量：$5 + 0.5X_1 + 0.5sin(X_1) + (X_1 - 5)^2$
    <pre style="background-color: #f5f5f5">X = np.column_stack((x, np.sin(x), (x-5)**2, np.ones(nsample)))</pre>
    然后设置模型里的 $\beta_0$,$\beta_1$，这里要设置成 0.5, 0.5, -0.02, 5。
    <pre style="background-color: #f5f5f5">beta = np.array([0.5, 0.5, -0.02, 5.])</pre>
    由此，我们"点乘"，生成反应项真实值 $Y(t)$。
    <pre style="background-color: #f5f5f5">y_true = np.dot(X, beta)</pre>
    生成拟合值$Y(t)$
    <pre style="background-color: #f5f5f5">y = y_true + sig * np.random.normal(size=nsample)</pre>
    然后获取拟合结果。
    <pre style="background-color: #f5f5f5">res = sm.OLS(y, X).fit()</pre>
    回归系数。
    <pre style="background-color: #f5f5f5">print('Parameters: ', res.params)</pre>
    得到
    <pre><span style="color: red">[ 0.47040466  0.2931004  -0.01826292  5.24935422]</span></pre>
    和实际的回归系数非常接近。
    <pre><span style="color: red">[0.5, 0.5, -0.02, 5.]</span></pre>
    标准差
    <pre style="background-color: #f5f5f5">print('Standard errors: ', res.bse)</pre>
    得到
    <pre><span style="color: red">[0.02853117 0.11215937 0.00250506 0.18499717]</span></pre>
    预测值
    <pre style="background-color: #f5f5f5">print('Predicted values: ', res.predict())</pre>
    得到
    <pre><code>[ 4.79278116  5.17262168  5.52726298  5.84073136  6.10281792  6.31075592
  6.46967527  6.59175976  6.69424528  6.796588    6.91726779  7.07075203
  7.26511865  7.50072896  7.77016828  8.05946415  8.35038197  8.62342091
  8.8610178   9.05043274  9.18584224  9.26929595  9.31037998  9.32464188
  9.33103621  9.34881043  9.39434252  9.47845015  9.60461339  9.76840293
  9.95820778 10.15714295 10.34582361 10.50554994 10.62137947 10.68458209
 10.69407437 10.65659757 10.58561009 10.49907624 10.41651482 10.3557922
 10.33018692 10.34620807 10.4025259  10.49019023 10.594101   10.69548911
 10.77500019 10.81587443]</code></pre>
     和实际值相比
     <pre><code>[ 4.5         4.98084442  5.42241818  5.79747174  6.08858976  6.29105242
  6.41361085  6.47704939  6.51077074  6.54796517  6.62015751  6.75202765
  6.95735574  7.23675814  7.57758613  7.95600411  8.34090568  8.69902434
  9.0003991   9.22329697  9.35778363  9.40735561  9.38836583  9.32733686
  9.25660331  9.20899939  9.21246432  9.28545197  9.43389898  9.65024938
  9.91469599 10.19843472 10.46839697 10.69268271 10.84580159 10.91286091
 10.89201244 10.79475611 10.64405059 10.47054122 10.30752511 10.1854805
 10.12705925 10.14336524 10.23213001 10.37808548 10.55547244 10.7322727
 10.87546961 10.95647263]
     </code></pre>
    打印回归拟合的摘要。
    <pre style="background-color: #f5f5f5">print(results.summary())</pre>
    <pre><code>
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.920
Model:                            OLS   Adj. R-squared:                  0.915
Method:                 Least Squares   F-statistic:                     175.9
Date:                Mon, 01 Jun 2020   Prob (F-statistic):           3.30e-25
Time:                        15:51:38   Log-Likelihood:                -38.308
No. Observations:                  50   AIC:                             84.62
Df Residuals:                      46   BIC:                             92.26
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P>|t|      [0.025      0.975]
------------------------------------------------------------------------------
x1             0.4704      0.029     16.487      0.000       0.413       0.528
x2             0.2931      0.112      2.613      0.012       0.067       0.519
x3            -0.0183      0.003     -7.290      0.000      -0.023      -0.013
const          5.2494      0.185     28.375      0.000       4.877       5.622
==============================================================================
Omnibus:                        1.779   Durbin-Watson:                   2.359
Prob(Omnibus):                  0.411   Jarque-Bera (JB):                1.440
Skew:                           0.414   Prob(JB):                        0.487
Kurtosis:                       2.933   Cond. No.                         221.
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    </code></pre>
    调用包生成预测值的“置信区间” (prediction standard)
    <pre style="background-color: #f5f5f5">prstd, iv_l, iv_u = wls_prediction_std(res)</pre>
    调用matplotlib.pyplot包形成图像
    <pre style="background-color: #f5f5f5">fig, ax = plt.subplots(figsize=(8,6))
ax.plot(x, y, 'o', label="data")
ax.plot(x, y_true, 'b-', label="True")
ax.plot(x, res.fittedvalues, 'r--.', label="OLS")
ax.plot(x, iv_u, 'r--')
ax.plot(x, iv_l, 'r--')
ax.legend(loc='best')
plt.show()</pre>
    <img src="/img/python-OLS-non-linear_1.png">
</p>


<p>整体源代码：</p>
<pre><code style="color: #dbdbdb" >import numpy as np
import statsmodels.api as sm
import matplotlib.pyplot as plt
from statsmodels.sandbox.regression.predstd import wls_prediction_std


'''OLS non-linear curve but linear in parameters'''
np.random.seed(9876789)
nsample = 50
sig = 0.5
x = np.linspace(0, 20, nsample)
X = np.column_stack((x, np.sin(x), (x-5)**2, np.ones(nsample)))
beta = [0.5, 0.5, -0.02, 5.]

y_true = np.dot(X, beta)
y = y_true + sig * np.random.normal(size=nsample)

res = sm.OLS(y, X).fit()
print(res.summary())

print('Parameters: ', res.params)
print('Standard errors: ', res.bse)
print('Predicted values: ', res.predict())

'''Draw a plot to compare the true relationship to OLS predictions.
Confidence intervals around the predictions are built using the wls_prediction_std command.'''
prstd, iv_l, iv_u = wls_prediction_std(res)

fig, ax = plt.subplots(figsize=(8,6))

ax.plot(x, y, 'o', label="data")
ax.plot(x, y_true, 'b-', label="True")
ax.plot(x, res.fittedvalues, 'r--.', label="OLS")
ax.plot(x, iv_u, 'r--')
ax.plot(x, iv_l, 'r--')
ax.legend(loc='best')
plt.show()
</code></pre>
        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>John Ho</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://github.com/junhe-S/junhe-S.github.io/2020/06/01/python-OLS-non-linear/">https://github.com/junhe-S/junhe-S.github.io/2020/06/01/python-OLS-non-linear/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2020 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/python-OLS/"># python OLS</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/06/01/python-OLS-dummy-variables/">python-OLS_dummy_variables</a>
            
            
            <a class="next" rel="next" href="/2020/05/31/python-OLS/">python_OLS</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© John Ho | Powered by Hexo & Chic</span>
    </div>
</footer>

<script src="/js/highlight.pack.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>
    </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/koharu.model.json"},"display":{"position":"right","width":200,"height":420},"mobile":{"show":false},"log":false});</script></body>
</html>
